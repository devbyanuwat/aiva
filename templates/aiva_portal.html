<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Thai:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <title>AIVA - Vocational Assistant</title>
  <style>
    /* --- Dropdown Styles --- */
    .dropdown {
      position: relative;
      display: inline-block;
      width: 100%;
      max-width: 300px;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: rgba(32, 95, 207, 0.95);
      min-width: 300px;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      border-radius: 12px;
      margin-top: 5px;
      border: 1px solid #24DDFF;
      backdrop-filter: blur(10px);
    }

    .dropdown-content a {
      color: white;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      font-size: 1.1rem;
      transition: background 0.2s;
      border-bottom: 1px solid rgba(36, 221, 255, 0.2);
      cursor: pointer;
    }

    .dropdown-content a:last-child {
      border-bottom: none;
    }

    .dropdown-content a:hover {
      background-color: #265FF6;
      color: #24DDFF;
    }

    .dropdown:hover .dropdown-content {
      display: block;
    }

    /* --- Global & Layout --- */
    html,
    body,
    button,
    input,
    textarea,
    select {
      font-family: 'IBM Plex Thai', sans-serif;
    }

    :root {
      --button-radius: 18px;
      --button-border: 3px;
      --mic-size: 110px;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background-color: #0a1128;
      background-image: url("{{ url_for('static', filename='bg.png') }}");
      background-repeat: no-repeat;
      background-position: center center;
      background-attachment: fixed;
      background-size: cover;
      overflow-x: hidden;
      position: relative;
    }

    .container {
      width: 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-bottom: 50px;
    }

    .aiva-logo {
      margin-top: 50px;
      width: 70vw;
      max-width: 500px;
    }

    .aiva-tagline {
      color: #fff;
      font-size: clamp(1.5rem, 4vw, 2.1rem);
      font-weight: bold;
      margin-top: 10px;
      text-shadow: 0 2px 14px #000;
      text-align: center;
      padding: 0 20px;
    }

    .main-content {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      margin-top: 40px;
      width: 100%;
      max-width: 1200px;
      gap: 40px;
    }

    /* --- Video Section --- */
    .video-and-speech {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .video-frame {
      width: 320px;
      height: 550px;
      background: #000;
      border-radius: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 30px rgba(36, 221, 255, 0.3);
      border: 4px solid #24DDFF;
      overflow: hidden;
    }

    .bot-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      /* Video optimization - ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô */
      will-change: auto;
      contain: layout style paint;
    }

    /* --- Right Panel --- */
    .right-panel {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      width: 350px;
    }

    .actions {
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 100%;
      align-items: center;
    }

    .button-aiva {
      border: var(--button-border) solid #24DDFF;
      outline: none;
      font-size: 1.8rem;
      color: #fff;
      background: linear-gradient(90deg, #205FCF 0%, #265FF6 100%);
      border-radius: var(--button-radius);
      width: 300px;
      height: 80px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .button-aiva:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      filter: grayscale(0.5);
    }

    .button-aiva:hover:not(:disabled) {
      filter: brightness(1.2);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(36, 221, 255, 0.4);
    }

    .button-gradient-feedback {
      width: 300px;
      padding: 15px 0;
      font-size: 1.4rem;
      font-weight: bold;
      background: linear-gradient(90deg, #23e65a 0%, #1cc7eb 51%, #2867e6 100%);
      color: #fff;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .button-gradient-feedback:hover {
      transform: scale(1.05);
      filter: brightness(1.1);
    }

    /* --- Microphone --- */
    .mic-controls {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }

    .mic-btn-image {
      width: 80px;
      height: 80px;
      background: #fff;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      padding: 15px;
      box-shadow: 0 0 20px rgba(74, 220, 247, 0.5);
      transition: all 0.3s;
    }

    .mic-btn-image.active {
      animation: pulse 1.5s infinite;
      background: #4adcf7;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(74, 220, 247, 0.7);
      }

      70% {
        transform: scale(1.1);
        box-shadow: 0 0 0 20px rgba(74, 220, 247, 0);
      }

      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(74, 220, 247, 0);
      }
    }

    .mic-stop-btn {
      width: 80px;
      height: 80px;
      background: #e96487;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mic-stop-icon {
      width: 25px;
      height: 25px;
      background: white;
      border-radius: 4px;
    }

    /* --- Speech Box --- */
    .speech-box {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 600px;
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 2000;
      display: none;
      flex-direction: column;
      align-items: center;
      border: 2px solid #205FCF;
    }

    .speech-header {
      font-weight: bold;
      color: #205FCF;
      margin-bottom: 10px;
      font-size: 1.2rem;
    }

    #speech-live-text {
      font-size: 1.5rem;
      text-align: center;
      color: #333;
    }

    /* ‚≠ê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏¢‡∏∏‡∏î‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‚≠ê */
    .inline-stop-btn {
      margin-top: 15px;
      padding: 10px 25px;
      background-color: #e96487;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.2s;
    }

    .inline-stop-btn:hover {
      background-color: #d64d70;
      transform: scale(1.05);
    }

    .inline-stop-btn:active {
      transform: scale(0.95);
    }

    .inline-stop-icon {
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 2px;
    }

    /* --- Overlays --- */
    .rating-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      z-index: 3000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .rating-overlay.active {
      display: flex;
    }

    .rating-popup-survey {
      background: white;
      padding: 30px;
      border-radius: 20px;
      width: 350px;
      text-align: center;
      position: relative;
    }

    .rating-star {
      font-size: 2.5rem;
      cursor: pointer;
      color: #ddd;
      transition: color 0.2s;
    }

    .rating-star.selected {
      color: #ffc94a;
    }

    .survey-submit {
      width: 100%;
      padding: 12px;
      background: #205FCF;
      color: white;
      border: none;
      border-radius: 10px;
      margin-top: 20px;
      cursor: pointer;
      font-weight: bold;
    }

    .popup-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      border: none;
      background: none;
    }

    #mic-loader {
      position: absolute;
      bottom: 80px;
      color: white;
      background: rgba(0, 0, 0, 0.8);
      padding: 10px 20px;
      border-radius: 20px;
      display: none;
      z-index: 10;
    }
  </style>
</head>

<body>

  <div class="container">
    <img class="aiva-logo" src="{{ url_for('static', filename='logo01.png') }}" alt="AIVA Logo">
    <div class="aiva-tagline">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏∞‡πÅ‡∏´‡πà‡∏á‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</div>

    <div class="main-content">
      <div class="video-and-speech">
        <div class="video-frame">
          <video class="bot-video" id="avatar-video" loop muted playsinline preload="none" disablepictureinpicture>
            <!-- Video ‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏á page load ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠ user interact -->
          </video>
          <div id="video-loader" style="position:absolute;color:#24DDFF;font-size:1.2rem;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        </div>
        <div id="mic-loader">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á...</div>
      </div>

      <div class="right-panel">
        <div class="actions">

          <div class="dropdown">
            <button class="button-aiva">‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
            <div class="dropdown-content" id="college-dropdown">
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏°‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏ì‡∏¥‡∏ä‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏≤‡∏á‡∏ô‡∏≤">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏ì‡∏¥‡∏ä‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏≤‡∏á‡∏ô‡∏≤</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏ì‡∏¥‡∏ä‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏ô‡∏ö‡∏∏‡∏£‡∏µ">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏ì‡∏¥‡∏ä‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏ô‡∏ö‡∏∏‡∏£‡∏µ</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏ì‡∏¥‡∏ä‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ä‡∏±‡∏¢">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏û‡∏ì‡∏¥‡∏ä‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ä‡∏±‡∏¢</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏≠‡∏µ‡πà‡∏¢‡∏°‡∏•‡∏∞‡∏≠‡∏≠">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏≠‡∏µ‡πà‡∏¢‡∏°‡∏•‡∏∞‡∏≠‡∏≠</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏®‡∏¥‡∏•‡∏õ‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏®‡∏¥‡∏•‡∏õ‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏™‡∏≤‡∏£‡∏û‡∏±‡∏î‡∏ä‡πà‡∏≤‡∏á‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏™‡∏≤‡∏£‡∏û‡∏±‡∏î‡∏ä‡πà‡∏≤‡∏á‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏™‡∏≤‡∏£‡∏û‡∏±‡∏î‡∏ä‡πà‡∏≤‡∏á‡∏™‡∏µ‡πà‡∏û‡∏£‡∏∞‡∏¢‡∏≤">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏™‡∏≤‡∏£‡∏û‡∏±‡∏î‡∏ä‡πà‡∏≤‡∏á‡∏™‡∏µ‡πà‡∏û‡∏£‡∏∞‡∏¢‡∏≤</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ô‡∏ß‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ä‡∏π‡∏ó‡∏¥‡∏®">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ô‡∏ß‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏ä‡∏π‡∏ó‡∏¥‡∏®</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏†‡∏¥‡πÄ‡∏©‡∏Å‡∏´‡∏ô‡∏≠‡∏á‡∏à‡∏≠‡∏Å">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏†‡∏¥‡πÄ‡∏©‡∏Å‡∏´‡∏ô‡∏≠‡∏á‡∏à‡∏≠‡∏Å</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏£‡∏≤‡∏ä‡∏™‡∏¥‡∏ó‡∏ò‡∏≤‡∏£‡∏≤‡∏°">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏£‡∏≤‡∏ä‡∏™‡∏¥‡∏ó‡∏ò‡∏≤‡∏£‡∏≤‡∏°</a>
              <a data-text="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏î‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏î‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á</a>
              <a data-text="‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏†‡∏¥‡πÄ‡∏©‡∏Å‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ä‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á">‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤‡∏†‡∏¥‡πÄ‡∏©‡∏Å‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ä‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á</a>
            </div>
          </div>

          <button class="button-aiva" id="curriculum-btn">‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</button>

          <div class="dropdown">
            <button class="button-aiva">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</button>
            <div class="dropdown-content" id="career-dropdown">
              <a data-text="‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå">‡∏ä‡πà‡∏≤‡∏á‡∏¢‡∏ô‡∏ï‡πå</a>
              <a data-text="‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô">‡∏ä‡πà‡∏≤‡∏á‡∏Å‡∏•‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô</a>
              <a data-text="‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏•‡∏´‡∏∞">‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏•‡∏´‡∏∞</a>
              <a data-text="‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á">‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á</a>
              <a data-text="‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå">‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</a>
              <a data-text="‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á">‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</a>
              <a data-text="‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°">‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°</a>
              <a data-text="‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
              <a data-text="‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î">‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î</a>
              <a data-text="‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à">‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</a>
              <a data-text="‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°">‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°</a>
              <a data-text="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£</a>
            </div>
          </div>

          <button class="button-gradient-feedback" id="satisfaction-btn">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à</button>

          <div class="mic-controls">
            <button class="mic-btn-image" id="mic-btn" title="‡∏û‡∏π‡∏î">
              <img src="{{ url_for('static', filename='pu.png') }}" alt="Mic" style="width:100%">
            </button>
            <button class="mic-stop-btn" id="stop-btn" title="‡∏´‡∏¢‡∏∏‡∏î">
              <div class="mic-stop-icon"></div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="speech-box" id="speech-box">
    <div class="speech-header">üé§ AIVA ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</div>
    <div id="speech-live-text"></div>
    <button id="inline-stop-btn" class="inline-stop-btn">
      <div class="inline-stop-icon"></div>
      ‡∏´‡∏¢‡∏∏‡∏î
    </button>
  </div>

  <div class="rating-overlay" id="rating-overlay-survey">
    <div class="rating-popup-survey">
      <button class="popup-close" id="close-rating-survey">&times;</button>
      <div style="font-weight:bold; font-size:1.2rem; margin-bottom:10px;">‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à</div>
      <p>‡∏ó‡πà‡∏≤‡∏ô‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏Å‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÉ‡∏î?</p>
      <div id="star-group-survey">
        <span class="rating-star" data-value="1">‚òÖ</span>
        <span class="rating-star" data-value="2">‚òÖ</span>
        <span class="rating-star" data-value="3">‚òÖ</span>
        <span class="rating-star" data-value="4">‚òÖ</span>
        <span class="rating-star" data-value="5">‚òÖ</span>
      </div>
      <button class="survey-submit" id="submit-rating-survey">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // UI References
      const micBtn = document.getElementById('mic-btn');
      const stopBtn = document.getElementById('stop-btn');
      const inlineStopBtn = document.getElementById('inline-stop-btn');
      const loader = document.getElementById('mic-loader');
      const speechBox = document.getElementById('speech-box');
      const speechLive = document.getElementById('speech-live-text');
      const curriculumBtn = document.getElementById('curriculum-btn');
      const avatarVideo = document.getElementById('avatar-video');

      // Audio player ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏ô browser
      let currentAudio = null;

      // --- Video Lazy Load (‡∏•‡∏î load ‡∏ö‡∏ô server) ---
      let videoLoaded = false;
      const videoSrc = "{{ url_for('static', filename='aivavideo.mp4') }}";
      const videoLoader = document.getElementById('video-loader');

      function loadVideo() {
        if (videoLoaded) return;
        videoLoaded = true;

        const source = document.createElement('source');
        source.src = videoSrc;
        source.type = 'video/mp4';
        avatarVideo.appendChild(source);
        avatarVideo.load();

        avatarVideo.oncanplay = () => {
          if (videoLoader) videoLoader.style.display = 'none';
          avatarVideo.play().catch(() => { });
        };
      }

      // ‡πÇ‡∏´‡∏•‡∏î video ‡πÄ‡∏°‡∏∑‡πà‡∏≠ user interact ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
      ['click', 'touchstart', 'keydown'].forEach(event => {
        document.addEventListener(event, loadVideo, { once: true, passive: true });
      });

      // ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏á page load 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      setTimeout(loadVideo, 2000);

      // --- Auto Greeting ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ---
      async function autoGreeting() {
        try {
          const res = await fetch('/greeting');
          const data = await res.json();

          if (data.ok && data.message) {
            // ‡∏£‡∏≠ 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÉ‡∏´‡πâ page ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô
            setTimeout(() => {
              showSpeechBox(data.message);
              playTTS(data.message);
            }, 1500);
          }
        } catch (e) {
          console.log('Auto greeting failed:', e);
        }
      }

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      autoGreeting();

      // Pause video ‡πÄ‡∏°‡∏∑‡πà‡∏≠ tab ‡πÑ‡∏°‡πà active
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          avatarVideo.pause();
        } else if (videoLoaded) {
          avatarVideo.play().catch(() => { });
        }
      });

      // --- Web Speech API (STT ‡∏ö‡∏ô Browser) ---
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      let recognition = null;
      let isListening = false;

      if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'th-TH';
        recognition.continuous = false;
        recognition.interimResults = false;
        console.log('[STT] Web Speech API ready');
      } else {
        console.warn('[STT] Web Speech API not supported');
      }

      // --- Helper Functions ---
      function showSpeechBox(text) {
        speechBox.style.display = "flex";
        speechLive.innerText = text;
      }

      function hideSpeechBox() {
        speechBox.style.display = "none";
        speechLive.innerText = "";
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
      function stopAudio() {
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
          currentAudio = null;
        }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ü‡∏±‡∏á
      function stopListening() {
        if (recognition && isListening) {
          recognition.abort();
          isListening = false;
        }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏ô browser
      async function playTTS(text) {
        try {
          stopAudio(); // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô

          const res = await fetch('/tts_audio', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: text })
          });

          if (!res.ok) throw new Error('TTS failed');

          const blob = await res.blob();
          const audioUrl = URL.createObjectURL(blob);

          currentAudio = new Audio(audioUrl);
          currentAudio.play();

          // ‡∏ã‡πà‡∏≠‡∏ô speech box ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
          currentAudio.onended = () => {
            hideSpeechBox();
            URL.revokeObjectURL(audioUrl);
            currentAudio = null;
          };

        } catch (e) {
          console.error('TTS Error:', e);
        }
      }

      // --- Core AI Logic ---
      async function askAI(question) {
        stopAudio(); // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏î‡∏¥‡∏°

        showSpeechBox("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...");

        try {
          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å /ask ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡∏≤‡∏° AI (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ server ‡∏û‡∏π‡∏î)
          const res = await fetch('/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question: question })
          });
          const result = await res.json();

          showSpeechBox(result.answer);

          // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏ô browser
          playTTS(result.answer);

        } catch (e) {
          console.error(e);
          showSpeechBox("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
        }
      }

      // --- Event Listeners ---

      micBtn.addEventListener('click', async () => {
        if (!recognition) {
          alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ Chrome");
          return;
        }

        if (isListening) {
          stopListening();
          micBtn.classList.remove('active');
          loader.style.display = "none";
          return;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á
        micBtn.classList.add('active');
        loader.style.display = "block";
        hideSpeechBox();
        stopAudio();
        isListening = true;

        recognition.onresult = async (event) => {
          const transcript = event.results[0][0].transcript;
          console.log('[STT] Got:', transcript);

          micBtn.classList.remove('active');
          loader.style.display = "none";
          isListening = false;

          // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏õ AI
          showSpeechBox("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...");
          try {
            const res = await fetch('/ask', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ question: transcript })
            });
            const result = await res.json();
            showSpeechBox(result.answer);
            playTTS(result.answer);
          } catch (e) {
            showSpeechBox("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
          }
        };

        recognition.onerror = (event) => {
          console.error('[STT] Error:', event.error);
          micBtn.classList.remove('active');
          loader.style.display = "none";
          isListening = false;

          if (event.error === 'no-speech') {
            alert("‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
          } else if (event.error === 'not-allowed') {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô");
          }
        };

        recognition.onend = () => {
          if (isListening) {
            micBtn.classList.remove('active');
            loader.style.display = "none";
            isListening = false;
          }
        };

        try {
          recognition.start();
        } catch (e) {
          console.error('[STT] Start error:', e);
          micBtn.classList.remove('active');
          loader.style.display = "none";
          isListening = false;
        }
      });

      // 2. ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏°
      stopBtn.addEventListener('click', () => {
        stopAudio();
        stopListening();
        micBtn.classList.remove('active');
        loader.style.display = "none";
        hideSpeechBox();
      });

      // 2.1 ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏¢‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
      inlineStopBtn.addEventListener('click', () => {
        stopAudio();
        hideSpeechBox();
      });

      document.querySelectorAll('.dropdown-content a').forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const text = item.getAttribute('data-text');
          const parentId = item.parentElement.id;

          if (parentId === 'college-dropdown') {
            askAI(`‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á${text}`);
          } else if (parentId === 'career-dropdown') {
            askAI(`‡∏à‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤ ${text} ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á`);
          }
        });
      });

      curriculumBtn.addEventListener('click', () => {
        askAI('‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡∏´‡∏ô‡πà‡∏≠‡∏¢');
      });

      // --- Survey Logic ---
      const surveyOverlay = document.getElementById('rating-overlay-survey');
      const starGroup = document.getElementById('star-group-survey');
      let selectedStars = 0;

      document.getElementById('satisfaction-btn').onclick = () => surveyOverlay.classList.add('active');
      document.getElementById('close-rating-survey').onclick = () => surveyOverlay.classList.remove('active');

      document.querySelectorAll('#star-group-survey .rating-star').forEach(star => {
        star.onclick = function () {
          selectedStars = this.dataset.value;
          document.querySelectorAll('#star-group-survey .rating-star').forEach(s => {
            s.classList.toggle('selected', s.dataset.value <= selectedStars);
          });
        };
      });

      document.getElementById('submit-rating-survey').onclick = async () => {
        if (selectedStars == 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");

        try {
          const res = await fetch('/submit_feedback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ rating: selectedStars })
          });
          const data = await res.json();

          alert("‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô " + selectedStars + " ‡∏î‡∏≤‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö!");
          surveyOverlay.classList.remove('active');

          // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏ô browser
          if (data.message) {
            playTTS(data.message);
          }

          selectedStars = 0;
          document.querySelectorAll('.rating-star').forEach(s => s.classList.remove('selected'));

        } catch (e) {
          alert("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        }
      };

    });
  </script>

</body>

</html>